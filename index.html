<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Live Speech to Text</title>

<!-- Bootstrap 5 -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
    body {
        background-color: #f5f7fa;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    .app-container {
        max-width: 800px;
        margin: 60px auto;
        background: #ffffff;
        border-radius: 12px;
        padding: 25px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.08);
    }

    .app-title {
        text-align: center;
        font-weight: 600;
        margin-bottom: 20px;
    }

    .control-buttons {
        text-align: center;
        margin-bottom: 15px;
    }

    .control-buttons button {
        min-width: 120px;
        margin: 0 8px;
    }

    textarea {
        resize: none;
        font-size: 15px;
        line-height: 1.6;
    }

    .copy-btn {
        float: right;
        margin-top: 10px;
    }

    .note {
        font-size: 13px;
        color: #6c757d;
        margin-top: 10px;
    }
</style>
</head>

<body>

<div class="app-container">

    <div class="app-title">
        <h4>üé§ Live Speech to Text</h4>
        <small class="text-muted">Telugu + English (Code Mixed)</small>
    </div>

    <div class="control-buttons">
        <button id="startBtn" class="btn btn-success">
            üéô Speak
        </button>

        <button id="stopBtn" class="btn btn-danger">
            ‚èπ Stop
        </button>
    </div>

    <div class="mb-2">
        <textarea id="result" class="form-control" rows="12"
                  placeholder="Your speech will appear here..." readonly></textarea>
    </div>

    <!-- Upload Section -->
<div class="mt-3">

    <label class="form-label fw-semibold">
        üìÅ Upload Audio / Video for Transcription
    </label>

    <input type="file" id="uploadFile" class="form-control"
           accept="audio/*,video/*">

    <!-- Loading / Progress Bar -->
    <div class="progress mt-2" style="height: 22px; display:none;" id="uploadProgressWrapper">
        <div class="progress-bar progress-bar-striped progress-bar-animated"
             id="uploadProgress"
             role="progressbar"
             style="width: 0%">
            Processing‚Ä¶
        </div>
    </div>

    <small class="text-muted d-block mt-1">
        Note: Best used on Desktop/Laptop. Large files may take time.
    </small>

</div>


    <button id="copyBtn" class="btn btn-outline-primary copy-btn">
        üìã Copy Text
    </button>

    <div class="clearfix"></div>

    <div class="note">
        Tip: Use a good microphone and pause slightly between sentences for better accuracy.
    </div>

</div>

<script>
const startBtn = document.getElementById("startBtn");
const stopBtn  = document.getElementById("stopBtn");
const copyBtn  = document.getElementById("copyBtn");
const resultBox = document.getElementById("result");
const uploadInput = document.getElementById("uploadFile");
const progressWrapper = document.getElementById("uploadProgressWrapper");
const progressBar = document.getElementById("uploadProgress");

let recognition;
let finalTranscript = "";
let isRecording = false;

startBtn.addEventListener("click", () => {

    const SpeechRecognition =
        window.SpeechRecognition || window.webkitSpeechRecognition;

    if (!SpeechRecognition) {
        alert("Speech recognition not supported");
        return;
    }

    isRecording = true;

    recognition = new SpeechRecognition();
    recognition.continuous = false;       // ANDROID RULE
    recognition.interimResults = false;    // üîë PREVENT DUPLICATES
    recognition.lang = "te-IN";            // Stable (Telugu still works)

    recognition.onresult = (event) => {
        const text = event.results[0][0].transcript;
        finalTranscript += text.trim() + " ";
        resultBox.value = finalTranscript;
    };

    recognition.onerror = (e) => {
        console.error(e);
    };

    recognition.onend = () => {
        // üîÅ AUTO-RESTART UNTIL USER STOPS
        if (isRecording) {
            recognition.start();
        }
    };

    recognition.start();
});

stopBtn.addEventListener("click", () => {
    isRecording = false;
    if (recognition) recognition.stop();
});

copyBtn.addEventListener("click", () => {
    if (!resultBox.value.trim()) {
        alert("Nothing to copy!");
        return;
    }
    navigator.clipboard.writeText(resultBox.value);
    alert("Text copied");
});

/*
 STEP 1 ONLY:
 This is a placeholder to simulate upload/transcription flow.
 Actual transcription (Whisper) will be added in STEP 2.
*/
uploadInput.addEventListener("change", () => {

    if (!uploadInput.files.length) return;

    // Reset textarea (same box used for live transcription)
    resultBox.value = "";
    finalTranscript = "";

    // Show loading bar
    progressWrapper.style.display = "block";
    progressBar.style.width = "0%";
    progressBar.textContent = "Preparing‚Ä¶";

    // Fake progress simulation (UI only)
    let progress = 0;
    const fakeInterval = setInterval(() => {
        progress += 10;
        progressBar.style.width = progress + "%";
        progressBar.textContent = "Transcribing‚Ä¶";

        if (progress >= 100) {
            clearInterval(fakeInterval);

            // Hide progress bar
            setTimeout(() => {
                progressWrapper.style.display = "none";

                // Placeholder result (will be replaced by Whisper output)
                resultBox.value =
                    "üìù Transcription will appear here after processing the uploaded file.\n\n" +
                    "(Whisper integration comes in STEP 2)";

            }, 500);
        }
    }, 300);
});
</script>




</body>
</html>

